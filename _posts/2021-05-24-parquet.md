---
layout: post
title:  "Parquet"
date:   2021-05-24
excerpt: "Parquet"

comments: false
---
# parqeut
* 컬럼 기반으로 저장하는 파일 포맷
* 구글의 드러멜(dremel)에 기반 



# parqet 구조

* 헤더
4바이트 매직 숫자인 PAR1만 포함
* 하나 이상의 블록
    * 행 그룹 저장
        * 행 그룹 : 행에 대한 컬럼 데이터 포함한 컬럼 청크
        * 컬럼 청크의 데이터 - 페이지에 기록
        * 페이지 : 동일한 컬럼의 값만 포함하며, parquet 파일의 최소 저장 단위
            * 인코딩 및 압축 시 페이지 단위로 수행
            * 페이지 크기 ↓  - 페이지 수 증가  - 메타데이터 증가 저장용량 및 처리 시간 증가

    * block > cloumn chuck > page

* 꼬리말
포맷버전, 스키마, 추가 키-값 쌍, 파일의 모든 블록에 대한 메타데이터와 같은 정보를 포함




# 빅데이터 처리에 컬럼기반 포멧이 우세한 이유
: 빅데이터 처리는 분산 처리를 기본으로 하며 각 노드에  저장된 파일을 빨리 읽는 게 중요함.  컬럼 기반의 포멧은 이러한 조건이 행 기반 포멧보다 우수함

 ## 컬럼 기반 포멧의 장점
 1. 직렬화된 컬럼은 하나의 타입을 가짐
	•	행 기반에서는 이용할 수 없던 압축 방식을 적용해서 압축률이 우수하여 파일 크기가 작음
	•	인코딩 효율이 좋음
 
2. 필요한 컬럼만 읽을 수 있음
	•	컬럼 기반의 포맷은 내가 필요한 컬럼만 스캔하게 되므로 I/O 사용률이 낮으며 행 기반 포맷에 비해서 성능이 더 좋음


## parquet과 org 비교

|ORC |parqet
|:--------:|:--------:|
|행 기반(Row-based) | 컬럼 기반(Cloumnar)|
|하이브에 최적화된 포맷|Spark에 최적화된 포맷|



### 참고
https://github.com/apache/parquet-format
