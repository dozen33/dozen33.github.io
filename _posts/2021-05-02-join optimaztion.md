---
layout: post
title:  " optimizer join"
date:   2021-05-02
excerpt: " optimizer join"

comments: false
---
# 옵티마이저(Optimizer)
 SQL의 실행 계획을 수립하고 SQL을 실행하는 데이터베이스 관리 시스템의 소프트웨어

* 개발자가 SQL을 실행하면 파싱(Parsing)을 실행해서 SQL의 문법 검사 및 구문 분석을 수행
* 구문 분석이 완료되면, 옵티마이저가 규칙 기반 혹은 비용 기반으로 실행 계획을 수립
* 실행 수립이 완료되면, 최종적으로 SQL을 실행하고, 실행이 완료되면 데이터를 인출(Fetch)

#  optimizer join
### 1. Nested Loop Join
* 하나의 테이블에서 데이터를 먼저 찾고, 그 다음 테이블을 조인하는 형식으로 실행
* 먼저 조회되는 테이블을 선행/외부/Outer Table, 그 다음에 조회되는 테이블을 Inner Table
* 크기가 작은 선행 테이블로 실행해야 데이터 스캔의 범위를 줄일 수 있음
* RANDOM ACCESS량 줄여서 성능 향상시켜야 함
* 조인 컬럼의 인덱스 필요
* SELECT 뒤에 /*+ ordered use_nl(TABLE NAME) */ *의 힌트를 주어 사용
- ordered 힌트는 FROM 절에 나오는 테이블 순서대로 조인을 하게 하는 것
- ordered는 혼자 사용되지 않고, use_nl, use_merge, use_hash 힌트와 함께 사용

### 2. Sort Merge Join
* 두 개의 테이블을 SORT_AREA라는 메모리 공간에 모두 로딩(Loading)하고 정렬(Sort)을 수행
* 두 개의 테이블에서 Sort가 완료되면, 두 개의 테이블을 Merge
* Sort 수행 때문에 데이터 양이 많아지면 성능이 저하
* 정렬 데이터양이 너무 많으면, 정렬은 디스크 영역에서 수행되어 성능이 급격히 떨어짐
* SELECT 뒤에 /*+ ordered use_merge(TABLE NAME) */ * 힌트를 주어 사용

### 3. Hash Join
두 개의 테이블에서 작은 테이블을 Hash 메모리에 로딩(Loading)하고 두 개의 테이블의 조인 키를 사용해서 테이블을 생성
* Hash 함수를 사용해서 주소를 계산하고, 해당 주소를 사용해서 테이블을 조인하기 때문에, CPU 연산을 많이 함
* Hash Join 시에는 선행 테이블이 충분히 메모리에 로딩되는 크기여야만 함.

# 조인효율 향상의 원리
### 1. 조인 순서
* 처리범위가 가장 좁은 범위를 먼저 처리할 수록 조인의 효율은 증가

### 2. 조인 성공률
* 조인 작업이 수행된 후 조건을 만족하는 총  row 수(성공된 row수)
* 세 개 이상의 집합에 대한 조인 효율은 조인 성공률이 낮은 집합의 조인이 먼저 일어나는 것이 유리

### 3. 연결고리 상태
* 연결고리 정상 : 조건절에 기술되는 조인의 연결 컬럼에 인덱스가 모두 존재하는 상태
* 연결고리가 정상인 상태에서는 어느 방향으로 연결작업이 수행되든 간에 발생되는 연결작업은 동일
* 처리범위를 줄여주는 테이블이 먼저 처리되면 수행속도가 향상
